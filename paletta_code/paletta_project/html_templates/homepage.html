{% load static %}
{% if user.is_authenticated %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>{% if current_library %}{{ current_library.name }} - Library {% else %}Paletta Homepage{% endif %}</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Styles -->
  <link rel="icon" type="image/x-icon" href="{% static 'picture/logo.ico' %}">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <!-- CSS Reusables -->
  <link rel="stylesheet" href="{% static 'css/footer_reusable.css' %}">
  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/floating.css' %}">
  <link rel="stylesheet" href="{% static 'css/homepage.css' %}">
  <!-- JS -->
  <script src="{% static 'js/homepage.js' %}" defer></script>
  <script src="{% static 'js/floating_label.js' %}" defer></script>

</head>
<body>
  <header>
    <div class="actions">
        {% if user.role != 'customer' %}
        <a href="{% url 'upload' %}" style="text-decoration: none;">
          <button>
            <svg style="enable-background:new 0 0 24 24;" version="1.1" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <g id="grid_system"/>
              <g id="_icons">
                <g>
                  <path d="M8.7,9.7L11,7.4V15c0,0.6,0.4,1,1,1s1-0.4,1-1V7.4l2.3,2.3C15.5,9.9,15.7,10,16,10s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4l-4-4c-0.1-0.1-0.2-0.2-0.3-0.2c-0.2-0.1-0.5-0.1-0.8,0c-0.1,0.1-0.2,0.1-0.3,0.2l-4,4c-0.4,0.4-0.4,1,0,1.4S8.3,10.1,8.7,9.7z"/>
                  <path d="M19,13c-0.6,0-1,0.4-1,1v2c0,1.1-0.9,2-2,2H8c-1.1,0-2-0.9-2-2v-2c0-0.6-0.4-1-1-1s-1,0.4-1,1v2c0,2.2,1.8,4,4,4h8c2.2,0,4-1.8,4-4v-2C20,13.4,19.6,13,19,13z"/>
                </g>
              </g>
            </svg>
            Upload
          </button>
        </a>
        {% endif %}
        <button id="centerButton">
          <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <g data-name="Layer 2" id="Layer_2">
              <path d="M16,29A13,13,0,1,1,29,16,13,13,0,0,1,16,29ZM16,5A11,11,0,1,0,27,16,11,11,0,0,0,16,5Z" />
              <path d="M16,17a5,5,0,1,1,5-5A5,5,0,0,1,16,17Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,16,9Z" />
              <path d="M25.55,24a1,1,0,0,1-.74-.32A11.35,11.35,0,0,0,16.46,20h-.92a11.27,11.27,0,0,0-7.85,3.16,1,1,0,0,1-1.38-1.44A13.24,13.24,0,0,1,15.54,18h.92a13.39,13.39,0,0,1,9.82,4.32A1,1,0,0,1,25.55,24Z" />
            </g>
          </svg>
          My Center
        </button>
        <div class="popup" id="popupMenu">
          <a href="{% url 'profile' %}">My Profile</a>
          <a href="{% url 'collection' %}">My Collection</a>
          <a href="{% url 'cart' %}">My Cart</a>
          <a href="{% url 'order' %}">My Order</a>
          <a href="{% url 'logout' %}">Log Out</a>
        </div>
    </div>
  </header>

<main>
  <!--- Floating label -->
  <div id="floating-label" class="floating-label" onclick="toggleSidebar()">
    <span>&#9776; More Libraries</span>
  </div>

  <!-- sidebar -->
  <div id="sidebar" class="sidebar">
    <button class="close-btn" onclick="closeSidebar()">×</button>
    <h2>Explore more libraries</h2>

    <div class="search-bar">
      <input type="text" id="library-search-input" placeholder="Filter libraries by name...">
      <button id="library-search-clear" class="search-clear-btn" style="display: none;">×</button>
      <button id="library-search-button">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <path d="M18.856,14.624a10.022,10.022,0,1,0-4.234,4.234l4.254,4.255a2.994,2.994,0,1,0,4.239-4.23ZM2,10a8,8,0,1,1,8,8A8.009,8.009,0,0,1,2,10ZM21.7,21.708a1,1,0,0,1-1.4,0l-3.967-3.968a10.092,10.092,0,0,0,1.4-1.406L21.705,20.3a.976.976,0,0,1-.009,1.407Z"/>
        </svg>
      </button>
    </div>

    <h3>Quick Navigation</h3>
    <div class="more-libraries-nav" id="libraries-container">
      <!-- Default Paletta library -->
      <div class="library-button">
        <a href="{% url 'home' %}" class="{% if not current_library or current_library.name == 'Paletta' %}active{% endif %}">
            <img src="{% static 'picture/logo.jpg' %}" alt="Paletta">
            <span>Paletta</span>
        </a>
      </div>
      <!-- Dynamic libraries from database for authenticated users -->
        {% for library in libraries %}
        <div class="library-button">
            <a href="{% url 'library_detail' library_slug=library.name|slugify %}" class="{% if current_library and current_library.id == library.id %}active{% endif %}">
                {% if library.logo %}
                    <img src="{{ library.logo.url }}" alt="{{ library.name }}">
                {% else %}
                    <img src="{% static 'picture/default-logo.jpg' %}" alt="{{ library.name }}">
                {% endif %}
                <span>{{ library.name }}</span>
            </a>
        </div>
        {% empty %}
        <!-- No additional libraries message for authenticated users -->
        <p class="no-libraries">No additional libraries available.</p>
        {% endfor %}
    </div>

    <div class="admin-nav-btns">
        <button class="admin-nav-btn"><a href="{% url 'create_library' %}" style="text-decoration: none;">Create a Library</a></button>
        <button class="admin-nav-btn"><a href="{% url 'manage_libraries' %}" style="text-decoration: none;">Manage All Libraries</a></button>
        <button class="admin-nav-btn"><a href="{% url 'manage_administrators' %}" style="text-decoration: none;">Manage Administrator</a></button>
    </div>
  </div>
  <!-- sidebar-overlay -->
  <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>
  
  <div class="title-section">
    {% if current_library and current_library.name != 'Paletta' %}
      <img src="{% if current_library.logo %}{{ current_library.logo.url }}{% else %}{% static 'picture/default-logo.jpg' %}{% endif %}" alt="{{ current_library.name }} Logo">
      <h1>
        Welcome to<br>
        {{ current_library.name }}
      </h1>
    {% elif current_library and current_library.name == 'Paletta' %}
      <img src="{% static 'picture/logo.jpg' %}" alt="Logo">
      <h1>
        Bring out your<br>
        own color here
      </h1>
    {% endif %}
  </div>

  <p>Discover Any Clip You Like From Your Library</p>
  <div class="search-bar">
    <input type="text" id="video-search-input" placeholder="Search...">
    <button id="video-search-button">
      <svg id="Icons" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
        <path class="cls-1" d="M18.856,14.624a10.022,10.022,0,1,0-4.234,4.234l4.254,4.255a2.994,2.994,0,1,0,4.239-4.23ZM2,10a8,8,0,1,1,8,8A8.009,8.009,0,0,1,2,10ZM21.7,21.708a1,1,0,0,1-1.4,0l-3.967-3.968a10.092,10.092,0,0,0,1.4-1.406L21.705,20.3a.976.976,0,0,1-.009,1.407Z" />
        <path class="cls-1" d="M10,4a6.006,6.006,0,0,0-6,6,1,1,0,0,0,2,0,4,4,0,0,1,4-4,1,1,0,0,0,0-2Z" />
      </svg>
    </button>
  </div>

  <div class="categories" id="categories-container">
    <!-- "All" category is always shown -->
    {% if library_slug %}
    <a href="{% url 'clip_store' %}" style="text-decoration: none;">
    {% else %}
    <a href="{% url 'clip_store' %}{% if current_library %}?library_id={{ current_library.id }}{% endif %}" style="text-decoration: none;">
    {% endif %}
      <div class="category">
        <img src="{% static 'picture/All.png' %}" alt="All">
        <span>All</span>
      </div>
    </a>
    
    <!-- Dynamic categories from database for authenticated users -->
    {% for category in categories %}
    {% if library_slug %}
    <a href="{% url 'library_category' library_slug=library_slug category_slug=category.name|slugify %}" style="text-decoration: none;">
    {% else %}
    <a href="{% url 'category' category=category.name|lower %}{% if current_library %}?library_id={{ current_library.id }}{% endif %}" style="text-decoration: none;">
    {% endif %}
      <div class="category">
        <!-- Use the category image URL if available, otherwise use a default image -->
        {% if category.image_url %}
          <img src="{{ category.image_url }}" alt="{{ category.name }}" 
              data-category="{{ category.name }}" class="category-image">
        {% else %}
          <img src="{% static 'picture/main_campus.png' %}" alt="{{ category.name }}" 
              data-category="{{ category.name }}" class="category-image">
        {% endif %}
        <span>{{ category.name }}</span>
      </div>
    </a>
    {% empty %}
    <!-- If no categories are found, show a message -->
    <p class="no-categories">No categories created yet. Reach out to Admin for more information.</p>
    {% endfor %}
  </div>

  <div class="contributor-section">
    {% if user.role != 'customer' %}
      <p>Want to recommend a video contributor?</p>
      <a href="{% url 'contributor_apply' %}">
        <button>Recommend Here</button>
      </a>
    {% elif user.role == 'customer' %}
      <p>Want to be a video contributor?</p>
      <a href="{% url 'contributor_apply' %}">
        <button>Apply Here</button>
      </a>
    {% else %}
      <p>Create an account to recommend a video contributor.</p>
      <a href="{% url 'login' %}">
        <button>Login to Apply</button>
      </a>
    {% endif %}
  </div>
</main>

{% include "html_reusables/footer_reusable.html" %}

</body>
</html>

{% else %}
{% include "html_reusables/unauthorised_reusable.html" %}
{% endif %}